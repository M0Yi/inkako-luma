{% extends "layout/landing.html" %}

{% block title %}åˆ›å»ºæ´»åŠ¨ - Luma{% endblock %}

{% block content %}
<!-- Fullscreen Hero Section - å•é¡µå¡«æ»¡è§†çª— -->
<section class="create-section">
    <div class="create-container">

        <!-- åˆ›å»ºè¡¨å•åŒºåŸŸ -->
        <div class="create-form-wrapper">
            <form class="create-form" action="/events/create" method="POST" enctype="multipart/form-data">
                <div class="form-grid">
                    <!-- å·¦ä¾§ï¼šå›¾ç‰‡ä¸Šä¼ å’Œä¸»é¢˜ -->
                    <div class="form-left">
                        <!-- æ´»åŠ¨å°é¢ -->
                        <div class="cover-upload-section">
                            <div class="cover-upload-card">
                                <div class="cover-preview" id="coverPreview">
                                    <div class="cover-placeholder">
                                        <div class="astronaut-illustration">
                                            <i class="fas fa-rocket"></i>
                                        </div>
                                        <div class="upload-hint">
                                            <i class="fas fa-camera"></i>
                                            <span>ç‚¹å‡»ä¸Šä¼ æ´»åŠ¨å°é¢</span>
                                        </div>
                                    </div>
                                    <input type="file" id="coverInput" name="cover_image" accept="image/*" style="display: none;">
                                </div>
                            </div>
                        </div>

                        <!-- ä¸»é¢˜é€‰æ‹© -->
                        <div class="theme-section">
                            <h3 class="section-title">ä¸»é¢˜</h3>
                            <div class="theme-selector">
                                <div class="theme-preview">
                                    <div class="theme-color" id="selectedTheme" data-theme="elegant"></div>
                                    <span class="theme-name">ç®€çº¦</span>
                                </div>
                                <div class="theme-options" id="themeOptions">
                                    <div class="theme-option" data-theme="elegant" data-name="ç®€çº¦">
                                        <div class="theme-color elegant"></div>
                                    </div>
                                    <div class="theme-option" data-theme="vibrant" data-name="æ´»åŠ›">
                                        <div class="theme-color vibrant"></div>
                                    </div>
                                    <div class="theme-option" data-theme="nature" data-name="è‡ªç„¶">
                                        <div class="theme-color nature"></div>
                                    </div>
                                    <div class="theme-option" data-theme="tech" data-name="ç§‘æŠ€">
                                        <div class="theme-color tech"></div>
                                    </div>
                                </div>
                                <button type="button" class="theme-toggle" onclick="toggleThemeOptions()">
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- å³ä¾§ï¼šè¡¨å•å†…å®¹ -->
                    <div class="form-right">
                        <!-- åŸºæœ¬ä¿¡æ¯ -->
                        <div class="form-section">
                            <div class="calendar-header">
                                <div class="calendar-type">
                                    <i class="fas fa-user"></i>
                                    <span>ä¸ªäººæ—¥å†</span>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="visibility-toggle">
                                    <i class="fas fa-globe"></i>
                                    <span>å…¬å¼€</span>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                            </div>

                            <!-- æ´»åŠ¨æ ‡é¢˜ -->
                            <div class="form-group title-group">
                                <input
                                    type="text"
                                    name="title"
                                    class="title-input"
                                    placeholder="æ´»åŠ¨åç§°"
                                    required
                                >
                            </div>

                            <!-- æ—¶é—´è®¾ç½® -->
                            <div class="time-section">
                                <div class="time-item">
                                    <div class="time-dot start-dot"></div>
                                    <div class="time-label">å¼€å§‹</div>
                                    <div class="time-inputs">
                                        <input type="date" name="start_date" class="date-input" required>
                                        <input type="time" name="start_time" class="time-input" value="13:30" required>
                                    </div>
                                    <div class="timezone-info">
                                        <i class="fas fa-globe"></i>
                                        <span>GMT+08:00</span>
                                        <span class="location-text">ä¸Šæµ·</span>
                                    </div>
                                </div>

                                <div class="time-item">
                                    <div class="time-dot end-dot"></div>
                                    <div class="time-label">ç»“æŸ</div>
                                    <div class="time-inputs">
                                        <input type="date" name="end_date" class="date-input" required>
                                        <input type="time" name="end_time" class="time-input" value="14:30" required>
                                    </div>
                                </div>
                            </div>

                            <!-- åœ°ç‚¹è®¾ç½® -->
                            <div class="location-section">
                                <div class="location-header">
                                    <i class="fas fa-map-marker-alt"></i>
                                    <span>æ·»åŠ æ´»åŠ¨åœ°ç‚¹</span>
                                </div>
                                <div class="location-subtitle">çº¿ä¸‹åœ°ç‚¹æˆ–çº¿ä¸Šé“¾æ¥</div>
                                <div class="location-input-group">
                                    <input
                                        type="text"
                                        name="location"
                                        class="location-input"
                                        placeholder="è¾“å…¥åœ°å€æˆ–åœ¨çº¿ä¼šè®®é“¾æ¥"
                                    >
                                </div>
                            </div>

                            <!-- æ´»åŠ¨æè¿° -->
                            <div class="description-section">
                                <div class="description-header">
                                    <i class="fas fa-align-left"></i>
                                    <span>æ·»åŠ æè¿°</span>
                                </div>
                                <textarea
                                    name="description"
                                    class="description-textarea"
                                    placeholder="è¯¦ç»†ä»‹ç»æ‚¨çš„æ´»åŠ¨å†…å®¹ã€è®®ç¨‹å®‰æ’ã€æ³¨æ„äº‹é¡¹ç­‰..."
                                    rows="4"
                                ></textarea>
                            </div>
                        </div>

                        <!-- æ´»åŠ¨é€‰é¡¹ -->
                        <div class="options-section">
                            <h3 class="section-title">æ´»åŠ¨é€‰é¡¹</h3>

                            <!-- é—¨ç¥¨è®¾ç½® -->
                            <div class="option-item">
                                <div class="option-header">
                                    <i class="fas fa-ticket-alt"></i>
                                    <span class="option-label">é—¨ç¥¨</span>
                                    <div class="option-value">
                                        <span class="free-tag">å…è´¹</span>
                                        <i class="fas fa-edit"></i>
                                    </div>
                                </div>
                            </div>

                            <!-- å®¡æ ¸è®¾ç½® -->
                            <div class="option-item">
                                <div class="option-header">
                                    <i class="fas fa-user-check"></i>
                                    <span class="option-label">éœ€è¦å®¡æ ¸</span>
                                    <div class="toggle-switch">
                                        <input type="checkbox" id="requireApproval" name="require_approval" class="toggle-input">
                                        <label for="requireApproval" class="toggle-label"></label>
                                    </div>
                                </div>
                            </div>

                            <!-- äººæ•°é™åˆ¶ -->
                            <div class="option-item">
                                <div class="option-header">
                                    <i class="fas fa-users"></i>
                                    <span class="option-label">äººæ•°é™åˆ¶</span>
                                    <div class="toggle-switch">
                                        <input type="checkbox" id="limitCapacity" name="limit_capacity" class="toggle-input">
                                        <label for="limitCapacity" class="toggle-label"></label>
                                    </div>
                                </div>
                                <div class="capacity-input-section" id="capacityInputSection" style="display: none;">
                                    <div class="capacity-input-wrapper">
                                        <span class="capacity-label">æœ€å¤š</span>
                                        <input type="number" id="capacityNumber" name="max_capacity" class="capacity-input" placeholder="100" min="1" max="10000">
                                        <span class="capacity-label">äºº</span>
                                    </div>
                                </div>
                            </div>

                            <!-- åº§ä½æ’å¸ƒ -->
                            <div class="option-item">
                                <div class="option-header">
                                    <i class="fas fa-th-large"></i>
                                    <span class="option-label">åº§ä½æ’å¸ƒ</span>
                                    <div class="toggle-switch">
                                        <input type="checkbox" id="seatLayout" name="seat_layout" class="toggle-input">
                                        <label for="seatLayout" class="toggle-label"></label>
                                    </div>
                                </div>
                                <div class="seat-layout-hint" id="seatLayoutHint">
                                    <small class="hint-text">å¼€å¯åå¯ä»¥è®¾ç½®åº§ä½æ’å¸ƒå›¾</small>
                                </div>
                                <div class="seat-layout-config" id="seatLayoutConfig" style="display: none;">
                                    <button type="button" class="seat-layout-btn" id="openSeatLayoutBtn">
                                        <i class="fas fa-chair"></i> è®¾ç½®åº§ä½æ’å¸ƒ
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- åˆ›å»ºæŒ‰é’® -->
                <div class="form-actions">
                    <button type="submit" class="create-btn">
                        <i class="fas fa-plus-circle"></i>
                        åˆ›å»ºæ´»åŠ¨
                    </button>
                </div>
            </form>
        </div>
    </div>
</section>
{% endblock %}

{% block styles %}
/* é¦–é¡µä¸“ç”¨ - é€æ˜å¯¼èˆªæ  */
nav {
    background: transparent !important;
    backdrop-filter: none !important;
    border-bottom: none !important;
}

/* åˆ›å»ºé¡µé¢å®¹å™¨ */
.create-section {
    position: relative;
    min-height: 100vh;
    background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
    padding: 8rem 0 4rem 0;
}

.create-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white" opacity="0.05"/><circle cx="75" cy="75" r="1" fill="white" opacity="0.05"/><circle cx="50" cy="10" r="0.5" fill="white" opacity="0.08"/><circle cx="20" cy="80" r="0.5" fill="white" opacity="0.08"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
    pointer-events: none;
}

.create-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 2rem;
    position: relative;
    z-index: 2;
}


/* è¡¨å•åŒ…è£…å™¨ */
.create-form-wrapper {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-radius: 24px;
    padding: 3rem;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    animation: fadeInUp 0.8s ease-out 0.2s both;
}

/* è¡¨å•ç½‘æ ¼å¸ƒå±€ */
.form-grid {
    display: grid;
    grid-template-columns: 400px 1fr;
    gap: 3rem;
    margin-bottom: 2rem;
}

/* å·¦ä¾§åŒºåŸŸ */
.form-left {
    display: flex;
    flex-direction: column;
    gap: 2rem;
}

/* å°é¢ä¸Šä¼  */
.cover-upload-card {
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
}

.cover-preview {
    width: 100%;
    height: 300px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    position: relative;
    cursor: pointer;
    transition: all 0.3s ease;
}

.cover-preview:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
}

.cover-placeholder {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: white;
}

.astronaut-illustration {
    font-size: 4rem;
    margin-bottom: 1rem;
    opacity: 0.8;
}

.upload-hint {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 1rem;
    font-weight: 500;
    opacity: 0.9;
}

/* ä¸»é¢˜é€‰æ‹© */
.theme-section {
    background: #f8fafc;
    border-radius: 16px;
    padding: 1.5rem;
    border: 2px solid #e2e8f0;
}

.section-title {
    font-size: 1.125rem;
    font-weight: 600;
    color: #1f2937;
    margin-bottom: 1rem;
}

.theme-selector {
    position: relative;
}

.theme-preview {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem;
    background: white;
    border-radius: 12px;
    border: 2px solid #e2e8f0;
    cursor: pointer;
    transition: all 0.3s ease;
}

.theme-preview:hover {
    border-color: #6366f1;
}

.theme-color {
    width: 24px;
    height: 24px;
    border-radius: 6px;
    position: relative;
}

.theme-color.elegant {
    background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
}

.theme-color.vibrant {
    background: linear-gradient(135deg, #fef3c7 0%, #f59e0b 100%);
}

.theme-color.nature {
    background: linear-gradient(135deg, #d1fae5 0%, #10b981 100%);
}

.theme-color.tech {
    background: linear-gradient(135deg, #ddd6fe 0%, #8b5cf6 100%);
}

.theme-name {
    font-weight: 500;
    color: #374151;
}

.theme-toggle {
    position: absolute;
    right: 0.75rem;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: #6b7280;
    cursor: pointer;
    padding: 0.25rem;
    border-radius: 4px;
    transition: all 0.3s ease;
}

.theme-toggle:hover {
    color: #6366f1;
    background: rgba(99, 102, 241, 0.1);
}

.theme-options {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: white;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    padding: 0.5rem;
    margin-top: 0.5rem;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    z-index: 10;
    display: none;
}

.theme-options.show {
    display: block;
}

.theme-option {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.theme-option:hover {
    background: #f8fafc;
}

/* å³ä¾§è¡¨å•åŒºåŸŸ */
.form-right {
    display: flex;
    flex-direction: column;
    gap: 2rem;
}

/* æ—¥å†å¤´éƒ¨ */
.calendar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
}

.calendar-type, .visibility-toggle {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: #f8fafc;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.875rem;
    font-weight: 500;
    color: #374151;
}

.calendar-type:hover, .visibility-toggle:hover {
    background: #e2e8f0;
}

/* æ ‡é¢˜è¾“å…¥ */
.title-group {
    margin-bottom: 2rem;
}

.title-input {
    width: 100%;
    padding: 1rem;
    border: none;
    font-size: 2rem;
    font-weight: 600;
    background: transparent;
    color: #1f2937;
    outline: none;
    border-bottom: 3px solid #e2e8f0;
    transition: all 0.3s ease;
}

.title-input:focus {
    border-bottom-color: #6366f1;
}

.title-input::placeholder {
    color: #9ca3af;
    font-weight: 400;
}

/* æ—¶é—´è®¾ç½® */
.time-section {
    background: #f8fafc;
    border-radius: 16px;
    padding: 1.5rem;
    border: 2px solid #e2e8f0;
}

.time-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1rem;
}

.time-item:last-child {
    margin-bottom: 0;
}

.time-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    flex-shrink: 0;
}

.start-dot {
    background: #10b981;
}

.end-dot {
    background: #6b7280;
}

.time-label {
    font-weight: 500;
    color: #374151;
    min-width: 40px;
}

.time-inputs {
    display: flex;
    gap: 0.75rem;
    flex: 1;
}

.date-input, .time-input {
    padding: 0.75rem;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    font-size: 0.875rem;
    font-weight: 500;
    background: white;
    transition: all 0.3s ease;
}

.date-input:focus, .time-input:focus {
    outline: none;
    border-color: #6366f1;
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
}

.timezone-info {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    color: #6b7280;
    margin-left: auto;
}

.location-text {
    font-weight: 500;
}

/* åœ°ç‚¹è®¾ç½® */
.location-section {
    background: #f8fafc;
    border-radius: 16px;
    padding: 1.5rem;
    border: 2px solid #e2e8f0;
}

.location-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-weight: 600;
    color: #374151;
    margin-bottom: 0.5rem;
}

.location-subtitle {
    font-size: 0.875rem;
    color: #6b7280;
    margin-bottom: 1rem;
}

.location-input {
    width: 100%;
    padding: 0.875rem;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    font-size: 0.875rem;
    background: white;
    transition: all 0.3s ease;
}

.location-input:focus {
    outline: none;
    border-color: #6366f1;
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
}

/* æè¿°è®¾ç½® */
.description-section {
    background: #f8fafc;
    border-radius: 16px;
    padding: 1.5rem;
    border: 2px solid #e2e8f0;
}

.description-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-weight: 600;
    color: #374151;
    margin-bottom: 1rem;
}

.description-textarea {
    width: 100%;
    padding: 0.875rem;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    font-size: 0.875rem;
    background: white;
    resize: vertical;
    min-height: 120px;
    transition: all 0.3s ease;
    font-family: inherit;
}

.description-textarea:focus {
    outline: none;
    border-color: #6366f1;
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
}

/* æ´»åŠ¨é€‰é¡¹ */
.options-section {
    background: #f8fafc;
    border-radius: 16px;
    padding: 1.5rem;
    border: 2px solid #e2e8f0;
}

.option-item {
    padding: 1rem 0;
    border-bottom: 1px solid #e2e8f0;
}

.option-item:last-child {
    border-bottom: none;
    padding-bottom: 0;
}

.option-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.option-header i {
    color: #6b7280;
    margin-right: 0.75rem;
}

.option-label {
    font-weight: 500;
    color: #374151;
    flex: 1;
}

.option-value {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.free-tag, .unlimited-tag {
    background: #d1fae5;
    color: #065f46;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
}

/* å¼€å…³åˆ‡æ¢ */
.toggle-switch {
    position: relative;
}

.toggle-input {
    display: none;
}

.toggle-label {
    display: block;
    width: 48px;
    height: 24px;
    background: #e2e8f0;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
}

.toggle-label::after {
    content: '';
    position: absolute;
    top: 2px;
    left: 2px;
    width: 20px;
    height: 20px;
    background: white;
    border-radius: 50%;
    transition: all 0.3s ease;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.toggle-input:checked + .toggle-label {
    background: #6366f1;
}

.toggle-input:checked + .toggle-label::after {
    left: 26px;
}

/* äººæ•°è¾“å…¥åŒºåŸŸ */
.capacity-input-section {
    margin-top: 1rem;
    padding: 1rem;
    background: white;
    border-radius: 8px;
    border: 2px solid #e2e8f0;
    animation: slideDown 0.3s ease-out;
}

.capacity-input-wrapper {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    justify-content: center;
}

.capacity-label {
    font-size: 0.875rem;
    font-weight: 500;
    color: #374151;
}

.capacity-input {
    width: 80px;
    padding: 0.5rem 0.75rem;
    border: 2px solid #e2e8f0;
    border-radius: 6px;
    font-size: 0.875rem;
    font-weight: 600;
    text-align: center;
    background: #f8fafc;
    transition: all 0.3s ease;
}

.capacity-input:focus {
    outline: none;
    border-color: #6366f1;
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    background: white;
}

/* åº§ä½æ’å¸ƒæç¤º */
.seat-layout-hint {
    margin-top: 0.5rem;
    padding-left: 2rem;
}

/* åº§ä½æ’å¸ƒé…ç½®æŒ‰é’® */
.seat-layout-config {
    margin-top: 0.75rem;
    padding-left: 2rem;
}

.seat-layout-btn {
    background: linear-gradient(135deg, #f59e0b 0%, #f97316 100%);
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 12px;
    font-size: 0.95rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    box-shadow: 0 4px 15px rgba(245, 158, 11, 0.25);
}

.seat-layout-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(245, 158, 11, 0.35);
}

.seat-layout-btn:active {
    transform: translateY(0);
}

/* åº§ä½æ’å¸ƒå¼¹å‡ºé¡µé¢ */
.seat-layout-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    backdrop-filter: blur(5px);
}

.seat-layout-container {
    background: white;
    width: 95%;
    height: 90%;
    max-width: 1400px;
    max-height: 900px;
    border-radius: 20px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.seat-layout-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 1.5rem 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.seat-layout-header h2 {
    margin: 0;
    font-size: 1.5rem;
    font-weight: 600;
}

.close-btn {
    background: none;
    border: none;
    color: white;
    font-size: 1.5rem;
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 8px;
    transition: background 0.3s ease;
}

.close-btn:hover {
    background: rgba(255, 255, 255, 0.1);
}

.seat-layout-body {
    flex: 1;
    display: flex;
    overflow: hidden;
}

.seat-layout-sidebar {
    width: 320px;
    min-width: 300px;
    max-width: 400px;
    background: #f8fafc;
    border-right: 1px solid #e2e8f0;
    padding: 1.5rem;
    overflow-y: auto;
    flex-shrink: 0; /* é˜²æ­¢è¢«æŒ¤å‹ */
}

.seat-layout-main {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 1.5rem;
    background: white;
}

.control-section {
    margin-bottom: 2rem;
}

.control-section h3 {
    margin: 0 0 1rem 0;
    font-size: 1.1rem;
    font-weight: 600;
    color: #1f2937;
    border-bottom: 2px solid #e5e7eb;
    padding-bottom: 0.5rem;
}

.control-group {
    margin-bottom: 1rem;
}

.control-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
    color: #374151;
    font-size: 0.9rem;
}

.control-group input {
    width: 100%;
    padding: 0.75rem;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    font-size: 0.95rem;
    transition: border-color 0.3s ease;
}

.control-group input:focus {
    outline: none;
    border-color: #6366f1;
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
}

.table-config {
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    padding: 1rem;
    margin-bottom: 1rem;
}

.table-preview {
    width: 80px;
    height: 60px;
    margin: 0 auto 1rem;
    border: 2px solid #d1d5db;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8rem;
    font-weight: 600;
    color: #6b7280;
    position: relative;
}

.table-preview.round-table {
    border-radius: 50%;
    background: linear-gradient(135deg, #fef3c7 0%, #fde047 100%);
}

.table-preview.long-table {
    background: linear-gradient(135deg, #dbeafe 0%, #60a5fa 100%);
}

.add-table-btn {
    width: 100%;
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    color: white;
    border: none;
    padding: 0.75rem;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.add-table-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.25);
}

.clear-btn {
    width: 100%;
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    color: white;
    border: none;
    padding: 0.75rem;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.clear-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(239, 68, 68, 0.25);
}

.layout-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.control-btn {
    background: #f1f5f9;
    border: 1px solid #e2e8f0;
    padding: 0.75rem 1rem;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.9rem;
    color: #64748b;
}

.control-btn:hover {
    background: #e2e8f0;
    color: #475569;
}

.control-btn:disabled {
    background: #f8fafc;
    color: #cbd5e1;
    cursor: not-allowed;
    opacity: 0.6;
}

.control-btn:disabled:hover {
    background: #f8fafc;
    color: #cbd5e1;
}

.grid-wrapper {
    flex: 1;
    background: #f9fafb;
    border: 2px solid #e5e7eb;
    border-radius: 12px;
    padding: 20px;
    overflow: auto;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    cursor: grab;
    /* å¯ç”¨åŒå‘æ»šåŠ¨ */
    overflow-x: auto;
    overflow-y: auto;
    /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
    -webkit-overflow-scrolling: touch;
    scroll-behavior: smooth;
}

.grid-wrapper:active {
    cursor: grabbing;
}

.grid-wrapper.panning {
    cursor: grabbing;
    user-select: none;
}

/* ç¾åŒ–æ»šåŠ¨æ¡ */
.grid-wrapper::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

.grid-wrapper::-webkit-scrollbar-track {
    background: #f1f5f9;
    border-radius: 4px;
}

.grid-wrapper::-webkit-scrollbar-thumb {
    background: #cbd5e1;
    border-radius: 4px;
}

.grid-wrapper::-webkit-scrollbar-thumb:hover {
    background: #94a3b8;
}

.grid-wrapper::-webkit-scrollbar-corner {
    background: #f1f5f9;
}

.seat-grid {
    display: grid;
    gap: 2px;
    background: #f3f4f6;
    padding: 10px;
    border-radius: 8px;
    /* ç¡®ä¿ç½‘æ ¼å¯ä»¥è¶…å‡ºå®¹å™¨å¹¶æ˜¾ç¤ºæ»šåŠ¨æ¡ */
    min-width: max-content;
    min-height: max-content;
    /* åœ¨å®¹å™¨ä¸­å±…ä¸­ï¼Œä½†å…è®¸æº¢å‡º */
    margin: auto;
}

.seat-cell {
    background: white;
    border: 1px solid #d1d5db;
    border-radius: 4px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    font-size: 0.7rem;
    color: #6b7280;
}

.seat-cell:hover {
    background: #f3f4f6;
    transform: scale(1.1);
    z-index: 10;
}

.seat-cell.occupied {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    color: white;
    border-color: #059669;
}

.seat-cell.occupied:hover {
    background: linear-gradient(135deg, #059669 0%, #047857 100%);
}

.seat-cell.aisle {
    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    color: white;
    border-color: #d97706;
}

.seat-cell.aisle:hover {
    background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
}

.seat-cell.drag-preview {
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    transition: all 0.1s ease;
    z-index: 10;
    position: relative;
    border: 2px solid #3b82f6;
}

.seat-legend {
    display: flex;
    justify-content: center;
    gap: 2rem;
    margin-top: 1rem;
    padding: 1rem;
    background: #f8fafc;
    border-radius: 8px;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.9rem;
    color: #64748b;
}

.legend-color {
    width: 20px;
    height: 20px;
    border-radius: 4px;
    border: 1px solid #d1d5db;
}

.legend-color.empty {
    background: white;
}

.legend-color.occupied {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
}

.legend-color.aisle {
    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
}

/* åº§ä½ç»Ÿè®¡æ ·å¼ */
.seat-stats {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.75rem;
}

.stat-item {
    display: flex;
    flex-direction: column;
    padding: 0.75rem;
    background: #f8fafc;
    border-radius: 8px;
    border: 1px solid #e2e8f0;
}

.stat-label {
    font-size: 0.8rem;
    color: #64748b;
    margin-bottom: 0.25rem;
}

.stat-value {
    font-size: 1.25rem;
    font-weight: 600;
    color: #1e293b;
}

/* åº§ä½ç±»å‹é€‰æ‹©å™¨æ ·å¼ */
.seat-type-selector {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.seat-type-option {
    display: flex;
    align-items: center;
    padding: 0.75rem;
    background: #f8fafc;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.seat-type-option:hover {
    border-color: #cbd5e1;
    background: #f1f5f9;
}

.seat-type-option.active {
    border-color: #3b82f6;
    background: #eff6ff;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.seat-type-preview {
    width: 20px;
    height: 20px;
    border-radius: 4px;
    margin-right: 0.75rem;
    border: 1px solid rgba(0, 0, 0, 0.1);
}

.seat-type-option span {
    font-size: 0.9rem;
    font-weight: 500;
    color: #374151;
}

/* ä¸åŒåº§ä½ç±»å‹çš„æ ·å¼ */
.seat-cell.available {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    color: white;
    border-color: #059669;
}

.seat-cell.locked {
    background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
    color: white;
    border-color: #4b5563;
}

.seat-cell.special {
    background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
    color: white;
    border-color: #7c3aed;
}

.seat-cell.vip {
    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    color: white;
    border-color: #d97706;
}

.seat-cell.disabled {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    color: white;
    border-color: #dc2626;
}

/* å›¾ä¾‹é¢œè‰²æ›´æ–° */
.legend-color.available {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
}

.legend-color.locked {
    background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
}

.legend-color.special {
    background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
}

.legend-color.vip {
    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
}

.legend-color.disabled {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
}

.seat-layout-footer {
    background: #f8fafc;
    padding: 1.5rem 2rem;
    border-top: 1px solid #e2e8f0;
    display: flex;
    justify-content: flex-end;
    gap: 1rem;
}

.cancel-btn {
    background: white;
    color: #64748b;
    border: 2px solid #e2e8f0;
    padding: 0.75rem 2rem;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
}

.cancel-btn:hover {
    background: #f8fafc;
    border-color: #cbd5e1;
}

.save-btn {
    background: linear-gradient(135deg, #f59e0b 0%, #f97316 100%);
    color: white;
    border: none;
    padding: 0.75rem 2rem;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.save-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(245, 158, 11, 0.25);
}

/* å“åº”å¼è®¾è®¡ - åº§ä½æ’å¸ƒ */
@media (max-width: 1200px) {
    .seat-layout-sidebar {
        width: 300px;
        min-width: 280px;
    }
}

@media (max-width: 1024px) {
    .seat-layout-sidebar {
        width: 280px;
        min-width: 260px;
    }
}

@media (max-width: 768px) {
    .seat-layout-container {
        width: 100%;
        height: 100%;
        border-radius: 0;
    }

    .seat-layout-body {
        flex-direction: column;
    }

    .seat-layout-sidebar {
        width: 100%;
        min-width: unset;
        max-width: unset;
        height: auto;
        max-height: 200px;
        border-right: none;
        border-bottom: 1px solid #e2e8f0;
        flex-shrink: 1; /* åœ¨ç§»åŠ¨ç«¯å…è®¸æ”¶ç¼© */
    }

    .seat-layout-header {
        padding: 1rem;
    }

    .seat-layout-header h2 {
        font-size: 1.25rem;
    }

    .seat-layout-main {
        padding: 1rem;
    }

    .grid-wrapper {
        min-height: 300px;
    }
}

.hint-text {
    font-size: 0.75rem;
    color: #6b7280;
    font-style: italic;
}

/* åŠ¨ç”»æ•ˆæœ */
@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
        max-height: 0;
    }
    to {
        opacity: 1;
        transform: translateY(0);
        max-height: 100px;
    }
}

/* åˆ›å»ºæŒ‰é’® */
.form-actions {
    text-align: center;
    padding-top: 2rem;
    border-top: 2px solid #e2e8f0;
}

.create-btn {
    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
    color: white;
    border: none;
    padding: 1.25rem 3rem;
    border-radius: 16px;
    font-size: 1.125rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 0.75rem;
    box-shadow: 0 8px 25px rgba(99, 102, 241, 0.3);
}

.create-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 35px rgba(99, 102, 241, 0.4);
}

.create-btn:active {
    transform: translateY(-1px);
}

/* åŠ¨ç”» */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 1024px) {
    .form-grid {
        grid-template-columns: 1fr;
        gap: 2rem;
    }

    .form-left {
        order: 1;
    }

    .form-right {
        order: 0;
    }

    .cover-preview {
        height: 200px;
    }
}

@media (max-width: 768px) {
    .create-container {
        padding: 0 1rem;
    }

    .create-form-wrapper {
        padding: 2rem;
    }

    .page-title {
        font-size: 2.5rem;
    }

    .title-input {
        font-size: 1.5rem;
    }

    .time-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.75rem;
    }

    .time-inputs {
        width: 100%;
    }

    .timezone-info {
        margin-left: 0;
        margin-top: 0.5rem;
    }
}

@media (max-width: 480px) {
    .create-form-wrapper {
        padding: 1.5rem;
    }

    .page-title {
        font-size: 2rem;
    }

    .create-btn {
        padding: 1rem 2rem;
        font-size: 1rem;
    }
}
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // é¡µé¢åŠ è½½åŠ¨ç”»
    const animateElements = document.querySelectorAll('.create-form-wrapper');
    animateElements.forEach((element, index) => {
        element.style.opacity = '0';
        element.style.transform = 'translateY(30px)';

        setTimeout(() => {
            element.style.transition = 'opacity 0.8s ease-out, transform 0.8s ease-out';
            element.style.opacity = '1';
            element.style.transform = 'translateY(0)';
        }, index * 200);
    });

    // å°é¢å›¾ç‰‡ä¸Šä¼ 
    const coverPreview = document.getElementById('coverPreview');
    const coverInput = document.getElementById('coverInput');

    coverPreview.addEventListener('click', () => {
        coverInput.click();
    });

    coverInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                coverPreview.style.backgroundImage = `url(${e.target.result})`;
                coverPreview.style.backgroundSize = 'cover';
                coverPreview.style.backgroundPosition = 'center';
                coverPreview.querySelector('.cover-placeholder').style.display = 'none';
            };
            reader.readAsDataURL(file);
        }
    });

    // è®¾ç½®é»˜è®¤æ—¥æœŸ
    const today = new Date();
    const tomorrow = new Date(today);
    tomorrow.setDate(tomorrow.getDate() + 1);

    const startDateInput = document.querySelector('input[name="start_date"]');
    const endDateInput = document.querySelector('input[name="end_date"]');

    if (startDateInput) {
        startDateInput.value = tomorrow.toISOString().split('T')[0];
    }
    if (endDateInput) {
        endDateInput.value = tomorrow.toISOString().split('T')[0];
    }

    // äººæ•°é™åˆ¶å’Œåº§ä½æ’å¸ƒè”åŠ¨é€»è¾‘
    const limitCapacityCheckbox = document.getElementById('limitCapacity');
    const capacityInputSection = document.getElementById('capacityInputSection');
    const seatLayoutCheckbox = document.getElementById('seatLayout');

    // äººæ•°é™åˆ¶å¼€å…³äº‹ä»¶
    limitCapacityCheckbox.addEventListener('change', function() {
        if (this.checked) {
            // å¼€å¯äººæ•°é™åˆ¶æ—¶
            capacityInputSection.style.display = 'block';
            // è‡ªåŠ¨å¼€å¯åº§ä½æ’å¸ƒ
            seatLayoutCheckbox.checked = true;
            // æ˜¾ç¤ºåº§ä½æ’å¸ƒé…ç½®æŒ‰é’®
            updateSeatLayoutConfig();
            // èšç„¦åˆ°äººæ•°è¾“å…¥æ¡†
            setTimeout(() => {
                document.getElementById('capacityNumber').focus();
            }, 300);
        } else {
            // å…³é—­äººæ•°é™åˆ¶æ—¶
            capacityInputSection.style.display = 'none';
            // æ¸…ç©ºäººæ•°è¾“å…¥
            document.getElementById('capacityNumber').value = '';
        }
    });

    // æ›´æ–°åº§ä½æ’å¸ƒé…ç½®æŒ‰é’®æ˜¾ç¤º
    function updateSeatLayoutConfig() {
        const seatLayoutConfig = document.getElementById('seatLayoutConfig');
        if (seatLayoutCheckbox.checked) {
            seatLayoutConfig.style.display = 'block';
        } else {
            seatLayoutConfig.style.display = 'none';
        }
    }

    // åº§ä½æ’å¸ƒå¼€å…³äº‹ä»¶
    seatLayoutCheckbox.addEventListener('change', updateSeatLayoutConfig);

    // åº§ä½æ’å¸ƒåŠŸèƒ½åˆå§‹åŒ–
    const openSeatLayoutBtn = document.getElementById('openSeatLayoutBtn');
    const seatLayoutModal = document.getElementById('seatLayoutModal');

    // æ‰“å¼€åº§ä½æ’å¸ƒé¡µé¢
    if (openSeatLayoutBtn && seatLayoutModal) {
        openSeatLayoutBtn.addEventListener('click', function() {
            seatLayoutModal.style.display = 'flex';
            initSeatLayout();
        });
    }

    // è‡ªé€‚åº”å¤§å°æŒ‰é’®äº‹ä»¶å¤„ç†
    const autoResizeBtn = document.getElementById('autoResizeBtn');
    if (autoResizeBtn) {
        autoResizeBtn.addEventListener('click', function() {
            autoResizeSeatGrid();
        });
    }

    // è¡¨å•æäº¤å¤„ç†
    const createForm = document.querySelector('.create-form');
    createForm.addEventListener('submit', function(e) {
        e.preventDefault();

        // è·å–è¡¨å•æ•°æ®
        const formData = new FormData(createForm);
        const eventData = {
            title: formData.get('title'),
            start_date: formData.get('start_date'),
            start_time: formData.get('start_time'),
            end_date: formData.get('end_date'),
            end_time: formData.get('end_time'),
            location: formData.get('location'),
            description: formData.get('description'),
            require_approval: formData.get('require_approval') === 'on',
            limit_capacity: formData.get('limit_capacity') === 'on',
            max_capacity: formData.get('max_capacity') || null,
            seat_layout: formData.get('seat_layout') === 'on'
        };

        // ç®€å•éªŒè¯
        if (!eventData.title || !eventData.start_date || !eventData.start_time) {
            alert('è¯·å¡«å†™å¿…è¦çš„æ´»åŠ¨ä¿¡æ¯');
            return;
        }

        // å¦‚æœå¼€å¯äº†äººæ•°é™åˆ¶ä½†æ²¡æœ‰è¾“å…¥å…·ä½“æ•°é‡
        if (eventData.limit_capacity && (!eventData.max_capacity || eventData.max_capacity < 1)) {
            alert('è¯·è¾“å…¥æœ‰æ•ˆçš„äººæ•°é™åˆ¶');
            document.getElementById('capacityNumber').focus();
            return;
        }

        // æ¨¡æ‹Ÿåˆ›å»ºè¿‡ç¨‹
        const createBtn = document.querySelector('.create-btn');
        const originalText = createBtn.innerHTML;
        createBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> åˆ›å»ºä¸­...';
        createBtn.disabled = true;

        setTimeout(() => {
            alert('æ´»åŠ¨åˆ›å»ºæˆåŠŸï¼');
            createBtn.innerHTML = originalText;
            createBtn.disabled = false;
            // å®é™…é¡¹ç›®ä¸­è¿™é‡Œåº”è¯¥è·³è½¬åˆ°æ´»åŠ¨è¯¦æƒ…é¡µ
        }, 2000);
    });
});

// ä¸»é¢˜é€‰æ‹©åŠŸèƒ½
function toggleThemeOptions() {
    const themeOptions = document.getElementById('themeOptions');
    const toggleBtn = document.querySelector('.theme-toggle i');

    themeOptions.classList.toggle('show');
    toggleBtn.classList.toggle('fa-chevron-down');
    toggleBtn.classList.toggle('fa-chevron-up');
}

// ä¸»é¢˜é€‰æ‹©å¤„ç†
document.addEventListener('click', function(e) {
    if (e.target.closest('.theme-option')) {
        const option = e.target.closest('.theme-option');
        const theme = option.dataset.theme;
        const name = option.dataset.name;

        const selectedTheme = document.getElementById('selectedTheme');
        const themeName = document.querySelector('.theme-name');

        selectedTheme.className = `theme-color ${theme}`;
        selectedTheme.dataset.theme = theme;
        themeName.textContent = name;

        // éšè—é€‰é¡¹
        document.getElementById('themeOptions').classList.remove('show');
        document.querySelector('.theme-toggle i').classList.add('fa-chevron-down');
        document.querySelector('.theme-toggle i').classList.remove('fa-chevron-up');
    }

    // ç‚¹å‡»å¤–éƒ¨å…³é—­ä¸»é¢˜é€‰é¡¹
    if (!e.target.closest('.theme-selector')) {
        document.getElementById('themeOptions').classList.remove('show');
        document.querySelector('.theme-toggle i').classList.add('fa-chevron-down');
        document.querySelector('.theme-toggle i').classList.remove('fa-chevron-up');
    }
});

// åº§ä½æ’å¸ƒåŠŸèƒ½å°†åœ¨DOMContentLoadedä¸­åˆå§‹åŒ–

// åº§ä½æ’å¸ƒç›¸å…³å˜é‡
let seatGrid = [];
let gridRows = 10;
let gridCols = 10;
let cellSize = 30;
let currentSeatType = 'available'; // å½“å‰é€‰ä¸­çš„åº§ä½ç±»å‹

// æ‹–æ‹½ç¼–è¾‘ç›¸å…³å˜é‡
let isDragging = false;
let dragMode = null; // 'add' | 'remove' | 'aisle'
let dragStartCell = null;
let draggedCells = new Set(); // è®°å½•å·²å¤„ç†çš„å•å…ƒæ ¼ï¼Œé¿å…é‡å¤å¤„ç†

// ç”»é¢æ‹–åŠ¨ç›¸å…³å˜é‡
let isPanning = false;
let panStartX = 0;
let panStartY = 0;
let panStartScrollLeft = 0;
let panStartScrollTop = 0;
let isSpacePressed = false;

// åˆå§‹åŒ–åº§ä½æ’å¸ƒ
function initSeatLayout() {
    const gridContainer = document.getElementById('seatGrid');
    initSeatTypeSelector();
    updateSeatGrid();
    updateSeatStats();

    // æ·»åŠ å…¨å±€é¼ æ ‡äº‹ä»¶ç›‘å¬å™¨
    document.addEventListener('mouseup', endDrag);
    document.addEventListener('mousemove', handleGlobalMouseMove);

    // æ·»åŠ æ‹–åŠ¨åŠŸèƒ½çŠ¶æ€æ˜¾ç¤º
    function showPanHint() {
        const gridWrapper = document.querySelector('.grid-wrapper');
        if (!gridWrapper) return;

        let hintElement = document.getElementById('panHint');
        if (!hintElement) {
            hintElement = document.createElement('div');
            hintElement.id = 'panHint';
            hintElement.style.cssText = `
                position: absolute;
                top: 10px;
                left: 10px;
                background: rgba(0, 0, 0, 0.8);
                color: white;
                padding: 8px 12px;
                border-radius: 6px;
                font-size: 12px;
                z-index: 1000;
                pointer-events: none;
                opacity: 0;
                transition: opacity 0.3s ease;
            `;
            hintElement.innerHTML = 'ğŸ–±ï¸ å³é”®æ‹–åŠ¨ | âŒ¨ï¸ ç©ºæ ¼+å·¦é”®æ‹–åŠ¨ | ğŸ“± è§¦æ‘¸æ»‘åŠ¨';
            gridWrapper.appendChild(hintElement);
        }

        // æ˜¾ç¤ºæç¤º
        hintElement.style.opacity = '1';
        setTimeout(() => {
            if (hintElement) hintElement.style.opacity = '0';
        }, 3000);
    }

    // åœ¨å¤§ç½‘æ ¼æ—¶è‡ªåŠ¨æ˜¾ç¤ºæç¤º
    const totalCells = gridRows * gridCols;
    if (totalCells > 2000) {
        setTimeout(showPanHint, 1000);
    }
    // ç§»é™¤ mouseleave ç›‘å¬å™¨ï¼Œå› ä¸ºå®ƒä¼šè¿‡æ—©ç»“æŸæ‹–åŠ¨

    // é˜²æ­¢é€‰ä¸­æ–‡æœ¬
    gridContainer.addEventListener('selectstart', function(e) {
        e.preventDefault();
    });

    // åˆå§‹åŒ–ç”»é¢æ‹–åŠ¨åŠŸèƒ½
    initGridPanning();
}

// åˆå§‹åŒ–åº§ä½ç±»å‹é€‰æ‹©å™¨
function initSeatTypeSelector() {
    const seatTypeOptions = document.querySelectorAll('.seat-type-option');

    seatTypeOptions.forEach(option => {
        option.addEventListener('click', function() {
            // ç§»é™¤å…¶ä»–é€‰é¡¹çš„activeçŠ¶æ€
            seatTypeOptions.forEach(opt => opt.classList.remove('active'));

            // æ·»åŠ å½“å‰é€‰é¡¹çš„activeçŠ¶æ€
            this.classList.add('active');

            // æ›´æ–°å½“å‰åº§ä½ç±»å‹
            currentSeatType = this.dataset.type;
        });
    });
}

// åˆå§‹åŒ–ç”»é¢æ‹–åŠ¨åŠŸèƒ½
function initGridPanning() {
    const gridWrapper = document.querySelector('.grid-wrapper');

    if (!gridWrapper) return;

    // é”®ç›˜äº‹ä»¶ç›‘å¬ç©ºæ ¼é”®
    document.addEventListener('keydown', function(e) {
        if (e.code === 'Space' && !e.repeat) {
            e.preventDefault();
            isSpacePressed = true;
            gridWrapper.style.cursor = 'grab';
        }
    });

    document.addEventListener('keyup', function(e) {
        if (e.code === 'Space') {
            isSpacePressed = false;
            if (!isPanning) {
                gridWrapper.style.cursor = '';
            }
        }
    });

    // é¼ æ ‡äº‹ä»¶ - ä½¿ç”¨æ•è·é˜¶æ®µç¡®ä¿ä¼˜å…ˆå¤„ç†
    gridWrapper.addEventListener('mousedown', function(e) {
        // å³é”®æ‹–åŠ¨ æˆ– ç©ºæ ¼é”®+å·¦é”®æ‹–åŠ¨
        if (e.button === 2 || (e.button === 0 && isSpacePressed)) {
            e.preventDefault();
            e.stopPropagation();
            isPanning = true;
            panStartX = e.clientX;
            panStartY = e.clientY;
            panStartScrollLeft = gridWrapper.scrollLeft;
            panStartScrollTop = gridWrapper.scrollTop;
            gridWrapper.classList.add('panning');
            gridWrapper.style.cursor = 'grabbing';

            // éšè—æç¤ºï¼ˆå¦‚æœå­˜åœ¨ï¼‰
            const hintElement = document.getElementById('panHint');
            if (hintElement) {
                hintElement.style.opacity = '0';
            }

            return false; // é˜»æ­¢äº‹ä»¶è¿›ä¸€æ­¥ä¼ æ’­
        }
    }, true); // ä½¿ç”¨æ•è·é˜¶æ®µ

    // ç¦ç”¨å³é”®èœå•
    gridWrapper.addEventListener('contextmenu', function(e) {
        e.preventDefault();
        return false;
    });

    document.addEventListener('mousemove', function(e) {
        if (!isPanning) return;

        e.preventDefault();
        e.stopPropagation(); // é˜²æ­¢ä¸å…¶ä»–æ‹–åŠ¨åŠŸèƒ½å†²çª

        const deltaX = e.clientX - panStartX;
        const deltaY = e.clientY - panStartY;

        gridWrapper.scrollLeft = panStartScrollLeft - deltaX;
        gridWrapper.scrollTop = panStartScrollTop - deltaY;
    });

    document.addEventListener('mouseup', function() {
        if (isPanning) {
            isPanning = false;
            gridWrapper.classList.remove('panning');
            gridWrapper.style.cursor = isSpacePressed ? 'grab' : '';
        }
    });

    // è§¦æ‘¸äº‹ä»¶ï¼ˆç§»åŠ¨ç«¯ï¼‰
    let touchStartX = 0;
    let touchStartY = 0;
    let touchScrollLeft = 0;
    let touchScrollTop = 0;
    let isTouchPanning = false;

    gridWrapper.addEventListener('touchstart', function(e) {
        if (e.touches.length === 1) {
            const touch = e.touches[0];
            touchStartX = touch.clientX;
            touchStartY = touch.clientY;
            touchScrollLeft = gridWrapper.scrollLeft;
            touchScrollTop = gridWrapper.scrollTop;

            // å»¶è¿Ÿå¯åŠ¨è§¦æ‘¸æ‹–åŠ¨ä»¥åŒºåˆ†ç‚¹å‡»å’Œæ‹–åŠ¨
            setTimeout(() => {
                if (e.touches.length === 1) {
                    isTouchPanning = true;
                }
            }, 100);
        }
    }, { passive: true });

    gridWrapper.addEventListener('touchmove', function(e) {
        if (e.touches.length === 1 && isTouchPanning) {
            e.preventDefault();
            const touch = e.touches[0];
            const deltaX = touch.clientX - touchStartX;
            const deltaY = touch.clientY - touchStartY;

            gridWrapper.scrollLeft = touchScrollLeft - deltaX;
            gridWrapper.scrollTop = touchScrollTop - deltaY;
        }
    }, { passive: false });

    gridWrapper.addEventListener('touchend', function() {
        isTouchPanning = false;
    });
}

// æ›´æ–°åº§ä½ç»Ÿè®¡
function updateSeatStats() {
    let totalSeats = 0;
    let availableSeats = 0;
    let lockedSeats = 0;
    let specialSeats = 0;
    let vipSeats = 0;
    let disabledSeats = 0;

    for (let row = 0; row < gridRows; row++) {
        for (let col = 0; col < gridCols; col++) {
            const cellData = seatGrid[row][col];
            if (cellData.state !== 0 && cellData.state !== 2) { // ä¸æ˜¯ç©ºä½å’Œé€šé“
                totalSeats++;
                switch (cellData.type) {
                    case 'available':
                        availableSeats++;
                        break;
                    case 'locked':
                        lockedSeats++;
                        break;
                    case 'special':
                        specialSeats++;
                        break;
                    case 'vip':
                        vipSeats++;
                        break;
                    case 'disabled':
                        disabledSeats++;
                        break;
                }
            }
        }
    }

    // æ›´æ–°æ˜¾ç¤º
    document.getElementById('totalSeats').textContent = totalSeats;
    document.getElementById('availableSeats').textContent = availableSeats;
    document.getElementById('lockedSeats').textContent = lockedSeats;
    document.getElementById('specialSeats').textContent = specialSeats + vipSeats + disabledSeats;
}

// æ›´æ–°åº§ä½ç½‘æ ¼
function updateSeatGrid() {
    const gridContainer = document.getElementById('seatGrid');
    const gridWrapper = document.querySelector('.grid-wrapper');

    // æ ¹æ®ç½‘æ ¼å¤§å°æ™ºèƒ½è°ƒæ•´å•å…ƒæ ¼å°ºå¯¸
    const totalCells = gridRows * gridCols;
    let adaptiveCellSize;

    if (totalCells > 5000) {
        // å¤§ç½‘æ ¼ï¼šä½¿ç”¨è¾ƒå°çš„å•å…ƒæ ¼
        adaptiveCellSize = 20;
    } else if (totalCells > 2000) {
        // ä¸­ç­‰ç½‘æ ¼ï¼šä½¿ç”¨ä¸­ç­‰å•å…ƒæ ¼
        adaptiveCellSize = 25;
    } else {
        // å°ç½‘æ ¼ï¼šä½¿ç”¨æ­£å¸¸å¤§å°
        adaptiveCellSize = 35;
    }

    cellSize = adaptiveCellSize;

    gridContainer.innerHTML = '';
    gridContainer.style.gridTemplateColumns = `repeat(${gridCols}, ${cellSize}px)`;
    gridContainer.style.gridTemplateRows = `repeat(${gridRows}, ${cellSize}px)`;

    // å¤§ç½‘æ ¼æ—¶æ·»åŠ æ€§èƒ½ä¼˜åŒ–æç¤º
    if (totalCells > 5000) {
        console.log(`å¤§ç½‘æ ¼æ¨¡å¼: ${gridRows}x${gridCols} = ${totalCells}ä¸ªå•å…ƒæ ¼ï¼Œå·²ä¼˜åŒ–å•å…ƒæ ¼å¤§å°ä¸º${cellSize}px`);
    }

    // åˆå§‹åŒ–åº§ä½ç½‘æ ¼æ•°æ®
    seatGrid = Array(gridRows).fill(null).map(() =>
        Array(gridCols).fill(null).map(() => ({
            state: 0, // 0: ç©ºä½, 1: åº§ä½, 2: é€šé“
            type: 'available' // åº§ä½ç±»å‹: available, locked, special, vip, disabled
        }))
    );

    // åˆ›å»ºç½‘æ ¼å•å…ƒæ ¼
    for (let row = 0; row < gridRows; row++) {
        for (let col = 0; col < gridCols; col++) {
            const cell = document.createElement('div');
            cell.className = 'seat-cell';
            cell.dataset.row = row;
            cell.dataset.col = col;
            cell.style.width = cellSize + 'px';
            cell.style.height = cellSize + 'px';

            // ç‚¹å‡»åˆ‡æ¢åº§ä½çŠ¶æ€
            cell.addEventListener('click', function(e) {
                if (!isDragging) {
                    toggleSeat(row, col, this);
                }
            });

            // æ‹–æ‹½äº‹ä»¶ - åªåœ¨å·¦é”®ä¸”éç©ºæ ¼é”®æ—¶å¤„ç†
            cell.addEventListener('mousedown', function(e) {
                // å¦‚æœæ˜¯å³é”®æˆ–ç©ºæ ¼é”®+å·¦é”®ï¼Œä¸å¤„ç†åº§ä½æ‹–æ‹½ï¼Œè®©å®¹å™¨æ‹–åŠ¨ç”Ÿæ•ˆ
                if (e.button === 2 || (e.button === 0 && isSpacePressed)) {
                    return; // è®©äº‹ä»¶å†’æ³¡åˆ°å®¹å™¨å¤„ç†
                }

                if (e.button === 0) { // åªå¤„ç†å·¦é”®
                    e.preventDefault();
                    e.stopPropagation();
                    startDrag(row, col, this, e);
                }
            });

            // mouseenter äº‹ä»¶ç°åœ¨ç”±å…¨å±€ mousemove å¤„ç†ï¼Œç§»é™¤é‡å¤é€»è¾‘

            // mouseleave äº‹ä»¶å¤„ç†å·²ç§»é™¤ï¼Œç”±å…¨å±€äº‹ä»¶ç»Ÿä¸€ç®¡ç†

            gridContainer.appendChild(cell);
        }
    }

    // å¼ºåˆ¶é‡æ–°åˆå§‹åŒ–æ‹–åŠ¨åŠŸèƒ½ï¼Œç¡®ä¿å¤§ç½‘æ ¼ä¸‹æ­£å¸¸å·¥ä½œ
    setTimeout(() => {
        const gridWrapper = document.querySelector('.grid-wrapper');
        if (gridWrapper) {
            // è§¦å‘ä¸€ä¸ªè‡ªå®šä¹‰äº‹ä»¶æ¥é‡æ–°æ£€æŸ¥æ‹–åŠ¨çŠ¶æ€
            gridWrapper.dispatchEvent(new CustomEvent('gridUpdated'));

            // ç¡®ä¿æ»šåŠ¨æ¡æ˜¾ç¤º
            if (gridWrapper.scrollWidth > gridWrapper.clientWidth ||
                gridWrapper.scrollHeight > gridWrapper.clientHeight) {
                gridWrapper.style.cursor = 'grab';
            }
        }
    }, 100);
}

// è‡ªé€‚åº”å¤§å°åŠŸèƒ½
function autoResizeSeatGrid() {
    const gridWrapper = document.querySelector('.grid-wrapper');
    const gridContainer = document.getElementById('seatGrid');
    const autoResizeBtn = document.getElementById('autoResizeBtn');

    if (!gridWrapper || !gridContainer) return;

    // æ·»åŠ åŠ è½½çŠ¶æ€
    autoResizeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> è°ƒæ•´ä¸­...';
    autoResizeBtn.disabled = true;

    // å»¶è¿Ÿæ‰§è¡Œä»¥ç¡®ä¿å®¹å™¨å°ºå¯¸æ­£ç¡®
    setTimeout(() => {
        try {
            // è·å–å®¹å™¨çš„å®é™…å°ºå¯¸
            const containerWidth = gridWrapper.clientWidth - 40;
            const containerHeight = gridWrapper.clientHeight - 40;

            // è®¡ç®—æœ€ä½³çš„å•å…ƒæ ¼å°ºå¯¸ï¼Œæ ¹æ®ç½‘æ ¼å¤§å°æ™ºèƒ½è°ƒæ•´
            const totalCells = gridRows * gridCols;
            let maxDisplayCols, maxDisplayRows, minCellSize, maxCellSize;

            if (totalCells > 5000) {
                // å¤§ç½‘æ ¼ï¼šæ˜¾ç¤ºæ›´å¤šï¼Œä½†å•å…ƒæ ¼æ›´å°
                maxDisplayCols = Math.min(gridCols, 20);
                maxDisplayRows = Math.min(gridRows, 15);
                minCellSize = 15;
                maxCellSize = 25;
            } else if (totalCells > 2000) {
                // ä¸­ç­‰ç½‘æ ¼
                maxDisplayCols = Math.min(gridCols, 15);
                maxDisplayRows = Math.min(gridRows, 12);
                minCellSize = 20;
                maxCellSize = 35;
            } else {
                // å°ç½‘æ ¼
                maxDisplayCols = Math.min(gridCols, 12);
                maxDisplayRows = Math.min(gridRows, 10);
                minCellSize = 25;
                maxCellSize = 45;
            }

            const optimalCellWidth = Math.floor(containerWidth / maxDisplayCols);
            const optimalCellHeight = Math.floor(containerHeight / maxDisplayRows);
            const optimalCellSize = Math.min(optimalCellWidth, optimalCellHeight);

            // è®¾ç½®åˆç†çš„å°ºå¯¸èŒƒå›´
            cellSize = Math.max(Math.min(optimalCellSize, maxCellSize), minCellSize);

            // é‡æ–°æ¸²æŸ“ç½‘æ ¼
            updateSeatGrid();

            // æ·»åŠ è§†è§‰åé¦ˆ
            gridContainer.style.transition = 'all 0.3s ease';
            gridContainer.style.transform = 'scale(0.98)';

            setTimeout(() => {
                gridContainer.style.transform = 'scale(1)';
                setTimeout(() => {
                    gridContainer.style.transition = '';
                }, 300);
            }, 100);

            console.log(`è‡ªé€‚åº”è°ƒæ•´å®Œæˆ: å•å…ƒæ ¼å¤§å° ${cellSize}px, ç½‘æ ¼ ${gridRows}x${gridCols}`);

        } catch (error) {
            console.error('è‡ªé€‚åº”å¤§å°è°ƒæ•´å¤±è´¥:', error);
        } finally {
            // æ¢å¤æŒ‰é’®çŠ¶æ€
            autoResizeBtn.innerHTML = '<i class="fas fa-expand-arrows-alt"></i> è‡ªé€‚åº”å¤§å°';
            autoResizeBtn.disabled = false;
        }
    }, 100);
}

// å¤„ç†å…¨å±€é¼ æ ‡ç§»åŠ¨ï¼ˆç”¨äºæ‹–æ‹½ï¼‰
function handleGlobalMouseMove(event) {
    if (!isDragging) return;

    // é˜²æ­¢é»˜è®¤è¡Œä¸º
    event.preventDefault();

    // è·å–é¼ æ ‡ä½ç½®ä¸‹çš„å…ƒç´ 
    const elementUnderMouse = document.elementFromPoint(event.clientX, event.clientY);
    if (!elementUnderMouse || !elementUnderMouse.classList.contains('seat-cell')) {
        return;
    }

    // è·å–è¯¥å•å…ƒæ ¼çš„è¡Œåˆ—ä¿¡æ¯
    const row = parseInt(elementUnderMouse.dataset.row);
    const col = parseInt(elementUnderMouse.dataset.col);

    if (isNaN(row) || isNaN(col) || row < 0 || row >= gridRows || col < 0 || col >= gridCols) return;

    // å¤„ç†æ‹–æ‹½ç»è¿‡
    handleDragOver(row, col, elementUnderMouse);
}

// å¼€å§‹æ‹–æ‹½
function startDrag(row, col, element, event) {
    isDragging = true;
    dragStartCell = { row, col };
    draggedCells.clear();

    // ç¡®å®šæ‹–æ‹½æ¨¡å¼ï¼šæ ¹æ®å½“å‰å•å…ƒæ ¼çŠ¶æ€
    const currentState = seatGrid[row][col].state;
    if (event.ctrlKey || event.metaKey) {
        // æŒ‰ä½Ctrl/Cmdé”®ä¸ºé€šé“æ¨¡å¼
        dragMode = 'aisle';
    } else if (currentState === 0) {
        // ç©ºä½å¼€å§‹æ‹–æ‹½ -> æ·»åŠ åº§ä½æ¨¡å¼
        dragMode = 'add';
    } else {
        // åº§ä½å¼€å§‹æ‹–æ‹½ -> åˆ é™¤åº§ä½æ¨¡å¼
        dragMode = 'remove';
    }

    // å¤„ç†èµ·å§‹å•å…ƒæ ¼
    handleDragOver(row, col, element);

    // æ·»åŠ æ‹–æ‹½æ ·å¼
    document.body.style.cursor = dragMode === 'add' ? 'copy' :
                                 dragMode === 'remove' ? 'not-allowed' : 'crosshair';

    // æ˜¾ç¤ºæ‹–æ‹½æç¤º
    showDragHint();
}

// å¤„ç†æ‹–æ‹½ç»è¿‡çš„å•å…ƒæ ¼
function handleDragOver(row, col, element) {
    if (!isDragging) return;

    const cellKey = `${row}-${col}`;
    if (draggedCells.has(cellKey)) return; // é¿å…é‡å¤å¤„ç†

    draggedCells.add(cellKey);

    // æ ¹æ®æ‹–æ‹½æ¨¡å¼å¤„ç†å•å…ƒæ ¼
    switch (dragMode) {
        case 'add':
            if (seatGrid[row][col].state === 0) {
                setSeatState(row, col, element, 1, currentSeatType);
                element.classList.add('drag-preview');
            }
            break;
        case 'remove':
            if (seatGrid[row][col].state === 1) {
                setSeatState(row, col, element, 0);
                element.classList.add('drag-preview');
            }
            break;
        case 'aisle':
            setSeatState(row, col, element, 2); // 2è¡¨ç¤ºé€šé“
            element.classList.add('drag-preview');
            break;
    }
}

// ç»“æŸæ‹–æ‹½
function endDrag() {
    if (!isDragging) return;

    isDragging = false;
    dragMode = null;
    dragStartCell = null;
    draggedCells.clear();

    // æ¢å¤å…‰æ ‡
    document.body.style.cursor = '';

    // ç§»é™¤æ‹–æ‹½é¢„è§ˆæ ·å¼
    const previewCells = document.querySelectorAll('.drag-preview');
    previewCells.forEach(cell => cell.classList.remove('drag-preview'));

    // éšè—æ‹–æ‹½æç¤º
    hideDragHint();
}

// è®¾ç½®åº§ä½çŠ¶æ€ï¼ˆç»Ÿä¸€å‡½æ•°ï¼‰
function setSeatState(row, col, element, state, type = 'available') {
    seatGrid[row][col].state = state;
    if (state === 1) { // åªæœ‰åº§ä½çŠ¶æ€æ‰è®¾ç½®ç±»å‹
        seatGrid[row][col].type = type;
    }

    switch (state) {
        case 0: // ç©ºä½
            element.className = 'seat-cell';
            element.innerHTML = '';
            break;
        case 1: // åº§ä½
            element.className = `seat-cell ${type}`;
            element.innerHTML = '<i class="fas fa-chair"></i>';
            break;
        case 2: // é€šé“
            element.className = 'seat-cell aisle';
            element.innerHTML = '<i class="fas fa-walking"></i>';
            break;
    }

    // æ›´æ–°ç»Ÿè®¡
    updateSeatStats();
}

// åˆ‡æ¢åº§ä½çŠ¶æ€ï¼ˆä¿æŒåŸæœ‰åŠŸèƒ½ï¼‰
function toggleSeat(row, col, element) {
    const currentState = seatGrid[row][col].state;
    if (currentState === 0) {
        // ç©ºä½ -> å½“å‰é€‰æ‹©çš„åº§ä½ç±»å‹
        setSeatState(row, col, element, 1, currentSeatType);
    } else {
        // åº§ä½/é€šé“ -> ç©ºä½
        setSeatState(row, col, element, 0);
    }
}

// æ˜¾ç¤ºæ‹–æ‹½æç¤º
function showDragHint() {
    let hintElement = document.getElementById('dragHint');
    if (!hintElement) {
        hintElement = document.createElement('div');
        hintElement.id = 'dragHint';
        hintElement.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 1000;
            pointer-events: none;
        `;
        document.body.appendChild(hintElement);
    }

    const modeText = {
        'add': 'æ‹–æ‹½æ·»åŠ åº§ä½',
        'remove': 'æ‹–æ‹½åˆ é™¤åº§ä½',
        'aisle': 'æ‹–æ‹½æ·»åŠ é€šé“ (Ctrl+æ‹–æ‹½)'
    };

    hintElement.textContent = modeText[dragMode] || 'æ‹–æ‹½ç¼–è¾‘';
    hintElement.style.display = 'block';
}

// éšè—æ‹–æ‹½æç¤º
function hideDragHint() {
    const hintElement = document.getElementById('dragHint');
    if (hintElement) {
        hintElement.style.display = 'none';
    }
}

// ç½‘æ ¼å°ºå¯¸æ§åˆ¶
function updateGridSize() {
    const rowsInput = document.getElementById('gridRows');
    const colsInput = document.getElementById('gridCols');

    gridRows = parseInt(rowsInput.value) || 10;
    gridCols = parseInt(colsInput.value) || 10;

    updateSeatGrid();
}

// è®¾ç½®åœ†æ¡Œ
function addRoundTable() {
    const seats = parseInt(document.getElementById('roundTableSeats').value) || 8;
    const tables = parseInt(document.getElementById('roundTableCount').value) || 1;

    // ç®€å•çš„åœ†æ¡Œæ’å¸ƒé€»è¾‘ - åœ¨ç½‘æ ¼ä¸­å¤®åŒºåŸŸæ”¾ç½®
    const centerRow = Math.floor(gridRows / 2);
    const centerCol = Math.floor(gridCols / 2);

    for (let t = 0; t < tables; t++) {
        const tableRow = centerRow - 2 + Math.floor(t / 3) * 5;
        const tableCol = centerCol - 4 + (t % 3) * 4;

        // å›´ç»•ä¸­å¿ƒç‚¹æ”¾ç½®åº§ä½
        const radius = Math.ceil(seats / 8) + 1;
        for (let s = 0; s < seats; s++) {
            const angle = (2 * Math.PI * s) / seats;
            const seatRow = Math.round(tableRow + radius * Math.sin(angle));
            const seatCol = Math.round(tableCol + radius * Math.cos(angle));

            if (seatRow >= 0 && seatRow < gridRows && seatCol >= 0 && seatCol < gridCols) {
                const cell = document.querySelector(`[data-row="${seatRow}"][data-col="${seatCol}"]`);
                if (cell) {
                    setSeatState(seatRow, seatCol, cell, 1, currentSeatType);
                }
            }
        }
    }
}

// è®¾ç½®æ¡æ¡Œ
function addLongTable() {
    const cols = parseInt(document.getElementById('longTableCols').value) || 3;
    const rows = parseInt(document.getElementById('longTableRows').value) || 1;

    // åœ¨ç½‘æ ¼é¡¶éƒ¨åŒºåŸŸæ”¾ç½®æ¡æ¡Œ
    const startRow = 1;
    const seatsPerTable = cols * 2; // æ¡æ¡Œä¸¤ä¾§éƒ½æœ‰åº§ä½

    for (let r = 0; r < rows; r++) {
        const tableRow = startRow + r * 3;
        for (let c = 0; c < cols; c++) {
            const tableCol = Math.floor((gridCols - cols * 3) / 2) + c * 3;

            // æ¡æ¡Œä¸¤ä¾§æ”¾ç½®åº§ä½
            if (tableRow - 1 >= 0 && tableCol >= 0 && tableCol < gridCols) {
                const cell = document.querySelector(`[data-row="${tableRow - 1}"][data-col="${tableCol}"]`);
                if (cell) {
                    setSeatState(tableRow - 1, tableCol, cell, 1, currentSeatType);
                }
            }
            if (tableRow + 1 < gridRows && tableCol >= 0 && tableCol < gridCols) {
                const cell = document.querySelector(`[data-row="${tableRow + 1}"][data-col="${tableCol}"]`);
                if (cell) {
                    setSeatState(tableRow + 1, tableCol, cell, 1, currentSeatType);
                }
            }
        }
    }
}

// æ¸…ç©ºæ‰€æœ‰åº§ä½
function clearAllSeats() {
    const cells = document.querySelectorAll('.seat-cell');
    cells.forEach(cell => {
        cell.className = 'seat-cell';
        cell.innerHTML = '';
    });

    // æ¸…ç©ºæ•°æ®
    seatGrid = Array(gridRows).fill(null).map(() =>
        Array(gridCols).fill(null).map(() => ({
            state: 0, // 0: ç©ºä½, 1: åº§ä½, 2: é€šé“
            type: 'available' // åº§ä½ç±»å‹: available, locked, special, vip, disabled
        }))
    );

    // æ›´æ–°ç»Ÿè®¡
    updateSeatStats();
}

// å…³é—­åº§ä½æ’å¸ƒé¡µé¢
function closeSeatLayout() {
    document.getElementById('seatLayoutModal').style.display = 'none';
}

// ä¿å­˜åº§ä½æ’å¸ƒ
function saveSeatLayout() {
    // è¿™é‡Œå¯ä»¥å°†åº§ä½æ•°æ®ä¿å­˜åˆ°è¡¨å•æˆ–åç«¯
    console.log('åº§ä½æ’å¸ƒæ•°æ®:', seatGrid);
    closeSeatLayout();
}

// çª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°è°ƒæ•´ç½‘æ ¼
window.addEventListener('resize', function() {
    if (document.getElementById('seatLayoutModal').style.display === 'flex') {
        setTimeout(updateSeatGrid, 100);
    }
});
</script>

<!-- åº§ä½æ’å¸ƒå¼¹å‡ºé¡µé¢ -->
<div id="seatLayoutModal" class="seat-layout-modal" style="display: none;">
    <div class="seat-layout-container">
        <div class="seat-layout-header">
            <h2>åº§ä½æ’å¸ƒç³»ç»Ÿ</h2>
            <div class="pan-controls-info">
                <small style="color: #6b7280; font-size: 0.75rem;">
                    <i class="fas fa-mouse"></i> å³é”®æ‹–åŠ¨ç”»é¢ |
                    <i class="fas fa-keyboard"></i> ç©ºæ ¼+å·¦é”®æ‹–åŠ¨ |
                    <i class="fas fa-mobile-alt"></i> è§¦æ‘¸æ»‘åŠ¨
                </small>
            </div>
            <button class="close-btn" onclick="closeSeatLayout()">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="seat-layout-body">
            <!-- å·¦ä¾§æ§åˆ¶é¢æ¿ -->
            <div class="seat-layout-sidebar">
                <!-- åº§ä½ç»Ÿè®¡ -->
                <div class="control-section">
                    <h3>åº§ä½ç»Ÿè®¡</h3>
                    <div class="seat-stats">
                        <div class="stat-item">
                            <span class="stat-label">æ€»åº§ä½æ•°:</span>
                            <span id="totalSeats" class="stat-value">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">å¯é€‰åº§ä½:</span>
                            <span id="availableSeats" class="stat-value">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">é”å®šåº§ä½:</span>
                            <span id="lockedSeats" class="stat-value">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">ç‰¹æ®Šåº§ä½:</span>
                            <span id="specialSeats" class="stat-value">0</span>
                        </div>
                    </div>
                </div>

                <!-- åº§ä½ç±»å‹é€‰æ‹© -->
                <div class="control-section">
                    <h3>åº§ä½ç±»å‹</h3>
                    <div class="seat-type-selector">
                        <div class="seat-type-option active" data-type="available" data-color="#10b981">
                            <div class="seat-type-preview" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);"></div>
                            <span>å¯é€‰åº§ä½</span>
                        </div>
                        <div class="seat-type-option" data-type="locked" data-color="#6b7280">
                            <div class="seat-type-preview" style="background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);"></div>
                            <span>é”å®šåº§ä½</span>
                        </div>
                        <div class="seat-type-option" data-type="special" data-color="#8b5cf6">
                            <div class="seat-type-preview" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);"></div>
                            <span>ç‰¹æ®Šåº§ä½</span>
                        </div>
                        <div class="seat-type-option" data-type="vip" data-color="#f59e0b">
                            <div class="seat-type-preview" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);"></div>
                            <span>VIPåº§ä½</span>
                        </div>
                        <div class="seat-type-option" data-type="disabled" data-color="#ef4444">
                            <div class="seat-type-preview" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);"></div>
                            <span>ç¦ç”¨åº§ä½</span>
                        </div>
                    </div>
                </div>

                <div class="control-section">
                    <h3>ç½‘æ ¼è®¾ç½®</h3>
                    <div class="control-group">
                        <label>è¡Œæ•°:</label>
                        <input type="number" id="gridRows" value="10" min="5" max="20" onchange="updateGridSize()">
                    </div>
                    <div class="control-group">
                        <label>åˆ—æ•°:</label>
                        <input type="number" id="gridCols" value="10" min="5" max="20" onchange="updateGridSize()">
                    </div>
                </div>

                <div class="control-section">
                    <h3>åœ†æ¡Œè®¾ç½®</h3>
                    <div class="table-config">
                        <div class="table-preview round-table">
                            <span class="table-label">åœ†æ¡Œ</span>
                        </div>
                        <div class="control-group">
                            <label>ä½æ•°/äºº:</label>
                            <input type="number" id="roundTableSeats" value="8" min="4" max="12">
                        </div>
                        <div class="control-group">
                            <label>åœ†æ¡Œæ•°:</label>
                            <input type="number" id="roundTableCount" value="1" min="1" max="5">
                        </div>
                        <button class="add-table-btn" onclick="addRoundTable()">
                            <i class="fas fa-plus"></i> æ·»åŠ åœ†æ¡Œ
                        </button>
                    </div>
                </div>

                <div class="control-section">
                    <h3>æ¡æ¡Œæ’åˆ—</h3>
                    <div class="table-config">
                        <div class="table-preview long-table">
                            <span class="table-label">æ¡æ¡Œ</span>
                        </div>
                        <div class="control-group">
                            <label>åˆ—æ•°:</label>
                            <input type="number" id="longTableCols" value="3" min="1" max="6">
                        </div>
                        <div class="control-group">
                            <label>è¡Œæ•°:</label>
                            <input type="number" id="longTableRows" value="1" min="1" max="3">
                        </div>
                        <button class="add-table-btn" onclick="addLongTable()">
                            <i class="fas fa-plus"></i> æ·»åŠ æ¡æ¡Œ
                        </button>
                    </div>
                </div>

                <div class="control-section">
                    <button class="clear-btn" onclick="clearAllSeats()">
                        <i class="fas fa-trash"></i> æ¸…ç©ºåº§ä½
                    </button>
                </div>
            </div>

            <!-- å³ä¾§åº§ä½ç½‘æ ¼ -->
            <div class="seat-layout-main">
                <div class="layout-controls">
                    <button id="autoResizeBtn" class="control-btn" title="æ”¯æŒç°åœºé…ç½®å¸ƒå±€æ”¾å¤§/ç¼©å°">
                        <i class="fas fa-expand-arrows-alt"></i> è‡ªé€‚åº”å¤§å°
                    </button>
                </div>

                <div class="grid-wrapper">
                    <div id="seatGrid" class="seat-grid"></div>
                </div>

                <div class="seat-legend">
                    <div class="legend-item">
                        <div class="legend-color empty"></div>
                        <span>ç©ºä½</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color available"></div>
                        <span>å¯é€‰åº§ä½</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color locked"></div>
                        <span>é”å®šåº§ä½</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color special"></div>
                        <span>ç‰¹æ®Šåº§ä½</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color vip"></div>
                        <span>VIPåº§ä½</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color disabled"></div>
                        <span>ç¦ç”¨åº§ä½</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color aisle"></div>
                        <span>é€šé“</span>
                    </div>
                </div>

                <div style="margin-top: 1rem; padding: 1rem; background: #e0f2fe; border-radius: 8px; font-size: 0.9rem; color: #0369a1;">
                    <div style="font-weight: 600; margin-bottom: 0.5rem;">ğŸ“– æ‹–æ‹½ç¼–è¾‘è¯´æ˜ï¼š</div>
                    <div>â€¢ <strong>æ™®é€šæ‹–æ‹½</strong>ï¼šä»ç©ºä½å¼€å§‹æ‹–æ‹½å¯æ‰¹é‡æ·»åŠ åº§ä½ï¼Œä»åº§ä½å¼€å§‹æ‹–æ‹½å¯æ‰¹é‡åˆ é™¤åº§ä½</div>
                    <div>â€¢ <strong>Ctrl+æ‹–æ‹½</strong>ï¼šæŒ‰ä½Ctrlé”®æ‹–æ‹½å¯æ·»åŠ é€šé“ï¼ˆç”¨äºè¿‡é“è§„åˆ’ï¼‰</div>
                    <div>â€¢ <strong>å•å‡»</strong>ï¼šå•å‡»ç©ºä½/åº§ä½å¯åˆ‡æ¢çŠ¶æ€</div>
                </div>
            </div>
        </div>

        <div class="seat-layout-footer">
            <button class="cancel-btn" onclick="closeSeatLayout()">å–æ¶ˆ</button>
            <button class="save-btn" onclick="saveSeatLayout()">
                <i class="fas fa-save"></i> è§„åˆ’å›¾ä¸Šä¼ 
            </button>
        </div>
    </div>
</div>

{% endblock %}
